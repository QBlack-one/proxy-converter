<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>代理订阅转换器</title>
    <meta name="description"
        content="支持 VMess/VLESS/SS/SSR/Trojan/Hysteria/Hysteria2/TUIC/WireGuard 等协议，转换为 Clash/Surge/Sing-Box 等格式">
    <link rel="stylesheet" href="css/style.css?v=2">
</head>

<body>

    <div class="container">

        <!-- Header -->
        <header class="header">
            <h1>⚡ 代理订阅转换器</h1>
            <p>多协议解析 · 多格式输出 · 一键订阅</p>
        </header>

        <!-- Input Card -->
        <div class="card">
            <div class="card-title">
                <div class="icon icon-input">📋</div>
                输入源
                <span class="text-muted" style="margin-left:auto;font-size:12px">支持拖拽文件 · Ctrl+Enter 快速转换</span>
            </div>
            <div class="input-wrapper" id="inputWrapper">
                <textarea id="inputArea"
                    placeholder="在此粘贴代理链接（每行一个），支持 vmess/vless/ss/ssr/trojan/hysteria/hy2/tuic/wg/socks5/snell/naive/anytls 等协议&#10;&#10;也支持 Base64 编码的订阅内容，或拖入配置文件"></textarea>
                <div class="drop-zone-overlay" id="dropOverlay">
                    <span>📄 松开以加载文件</span>
                </div>
            </div>
            <div class="btn-row">
                <button class="btn btn-primary" id="btnConvert" onclick="convert()">🔄 转换</button>
                <button class="btn btn-secondary" onclick="pasteFromClipboard()">📎 粘贴</button>
                <button class="btn btn-secondary" onclick="loadSample()">📦 示例</button>
                <button class="btn btn-danger" onclick="clearAll()">🗑️ 清空</button>
            </div>
        </div>

        <!-- 订阅信息管理 Card (默认隐藏) -->
        <div class="card" id="subManageCard" style="display:none">
            <div class="card-title">
                <div class="icon" style="background:rgba(139,92,246,0.15)">📊</div>
                订阅信息管理
                <button class="btn btn-sm btn-secondary" onclick="toggleSubManage()" style="margin-left:auto">✕
                    关闭</button>
            </div>
            <p style="font-size:13px;color:var(--text-secondary);margin-bottom:16px">
                配置订阅流量和到期时间信息，客户端会自动读取这些信息。
            </p>

            <!-- API 密钥设置 -->
            <div
                style="background:rgba(245,158,11,0.1);border:1px solid rgba(245,158,11,0.2);border-radius:8px;padding:12px;margin-bottom:16px">
                <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
                    <span style="font-size:12px;font-weight:600;color:#f59e0b">🔐 API 密钥</span>
                    <span style="font-size:11px;color:var(--text-muted)">(可选，用于保护管理接口)</span>
                </div>
                <div style="display:flex;gap:8px">
                    <input type="password" id="apiKeyInput" placeholder="留空则不启用认证"
                        style="flex:1;padding:8px 12px;background:var(--bg-secondary);border:1px solid var(--border);border-radius:6px;color:var(--text-primary);font-size:13px">
                    <button class="btn btn-sm btn-secondary" onclick="saveApiKey()">保存密钥</button>
                </div>
            </div>

            <div class="config-grid">
                <div class="config-item" style="grid-column: 1 / -1">
                    <label>订阅名称</label>
                    <input type="text" id="subTitle" placeholder="我的代理订阅">
                </div>
                <div class="config-item">
                    <label>更新间隔（小时）</label>
                    <input type="number" id="subUpdateInterval" value="24" min="1" max="168">
                </div>
                <div class="config-item">
                    <label>启用流量统计</label>
                    <select id="subTrafficEnabled" onchange="toggleTrafficInputs()">
                        <option value="true">是</option>
                        <option value="false">否</option>
                    </select>
                </div>
                <div class="config-item" id="trafficUploadGroup">
                    <label>已上传（GB）</label>
                    <input type="number" id="subTrafficUpload" value="0" min="0" step="0.01">
                </div>
                <div class="config-item" id="trafficDownloadGroup">
                    <label>已下载（GB）</label>
                    <input type="number" id="subTrafficDownload" value="0" min="0" step="0.01">
                </div>
                <div class="config-item" id="trafficTotalGroup">
                    <label>总流量（GB）</label>
                    <input type="number" id="subTrafficTotal" value="100" min="0" step="1">
                </div>
                <div class="config-item" id="trafficResetGroup">
                    <label>每月重置日期</label>
                    <input type="number" id="subTrafficResetDay" value="1" min="1" max="31">
                </div>
            </div>

            <div class="btn-row" style="margin-top:16px">
                <button class="btn btn-success" onclick="saveSubConfig()">💾 保存配置</button>
                <button class="btn btn-secondary" onclick="loadSubConfig()">🔄 重新加载</button>
                <button class="btn btn-danger" onclick="resetTraffic()">🔄 重置流量</button>
            </div>
        </div>

        <!-- Results Section -->
        <div id="resultsSection">

            <!-- Stats -->
            <div class="card">
                <div class="card-title">
                    <div class="icon icon-nodes">📊</div>
                    解析结果
                </div>
                <div class="stats-row" id="statsRow"></div>
            </div>

            <!-- Node List -->
            <div class="card">
                <div class="card-title">
                    <div class="icon icon-nodes">🌐</div>
                    节点列表
                    <span id="nodeCount" class="text-muted" style="margin-left:auto"></span>
                </div>
                <div class="filter-bar">
                    <input type="text" class="search-input" id="searchInput" placeholder="搜索节点名称、服务器地址..."
                        oninput="onSearchInput()">
                    <div id="filterChips" style="display:flex;gap:6px;flex-wrap:wrap"></div>
                </div>
                <div class="node-grid" id="nodeGrid"></div>
            </div>

            <!-- Output Card with Format Tabs -->
            <div class="card">
                <div class="card-title">
                    <div class="icon icon-output">📄</div>
                    配置输出
                </div>

                <!-- Format Tabs -->
                <div class="format-tabs">
                    <button class="format-tab active" data-format="clash-yaml">Clash YAML</button>
                    <button class="format-tab" data-format="clash-meta">Clash Meta</button>
                    <button class="format-tab" data-format="surge">Surge</button>
                    <button class="format-tab" data-format="sing-box">Sing-Box</button>
                    <button class="format-tab" data-format="base64">Base64 订阅</button>
                    <button class="format-tab" data-format="raw">原始链接</button>
                </div>

                <div class="output-preview" id="outputPreview"></div>

                <div class="btn-row">
                    <button class="btn btn-success" id="btnDownload" onclick="downloadConfig()">💾 下载 Clash
                        (.yaml)</button>
                    <button class="btn btn-secondary" onclick="copyConfig()">📋 复制配置</button>
                </div>
            </div>

        </div>

        <!-- 订阅服务面板 -->
        <div class="card" id="subServiceCard">
            <div class="card-title">
                <div class="icon" style="background:rgba(99,102,241,0.15)">🌐</div>
                订阅链接服务
                <span id="serverStatus" class="server-status offline">● 未启动</span>
            </div>

            <!-- 订阅信息统计 -->
            <div id="subInfoStats" class="sub-info-stats" style="display:none"></div>

            <!-- 操作按钮 -->
            <div class="btn-row" style="margin-bottom:16px">
                <button class="btn btn-primary" onclick="saveToSubService()" id="btnSaveSub">💾 保存节点</button>
                <button class="btn btn-secondary" onclick="toggleSubManage()" id="btnManageSub">⚙️ 订阅管理</button>
                <button class="btn btn-secondary" onclick="toggleNodeManage()">📋 节点管理</button>
                <button class="btn btn-danger" onclick="clearAllNodes()">🗑️ 清空节点</button>
                <span id="saveStatus" style="font-size:12px;color:var(--text-muted);align-self:center"></span>
            </div>

            <!-- 节点管理面板 -->
            <div id="nodeManagePanel" style="margin-bottom:16px">
                <div
                    style="background:var(--bg-secondary);border:1px solid var(--border);border-radius:12px;padding:16px">
                    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px">
                        <span style="font-weight:600;font-size:14px">📋 订阅节点管理</span>
                        <div style="display:flex;gap:8px;align-items:center">
                            <span id="nodeManageCount" style="font-size:12px;color:var(--text-muted)"></span>
                            <button class="btn btn-sm btn-secondary" onclick="toggleNodeManage()">✕ 关闭</button>
                        </div>
                    </div>

                    <!-- 添加节点 -->
                    <div style="display:flex;gap:8px;margin-bottom:12px">
                        <input type="text" id="addNodeInput" placeholder="粘贴协议链接（vmess:// vless:// ss:// trojan:// ...）"
                            style="flex:1;padding:8px 12px;background:var(--bg-primary);border:1px solid var(--border);border-radius:6px;color:var(--text-primary);font-size:13px;font-family:monospace">
                        <button class="btn btn-sm btn-success" onclick="addSingleNode()">➕ 添加</button>
                    </div>

                    <!-- 批量操作栏 -->
                    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;padding:8px 12px;background:rgba(255,255,255,0.05);border:1px solid var(--border);border-radius:6px"
                        id="batchActionBar" style="display:none">
                        <label style="display:flex;align-items:center;gap:8px;cursor:pointer;font-size:13px;margin:0">
                            <input type="checkbox" id="selectAllNodes" onchange="toggleSelectAllNodes(this)"
                                style="width:16px;height:16px;accent-color:var(--danger)">
                            <span style="font-weight:600">全选</span>
                        </label>
                        <button class="btn btn-sm"
                            style="background:rgba(239,68,68,0.1);color:#ef4444;border:none;pointer-events:none"
                            onclick="deleteSelectedNodes()" id="btnDeleteSelected">🗑️ 删除选中 (<span
                                id="selectedCount">0</span>)</button>
                    </div>

                    <!-- 节点列表 -->
                    <div id="nodeManageList" style="max-height:400px;overflow-y:auto"></div>
                </div>
            </div>

            <!-- 订阅 URL 列表 -->
            <div id="subUrlList" class="sub-url-list" style="display:none">
                <label
                    style="font-size:12px;font-weight:600;color:var(--text-secondary);text-transform:uppercase;letter-spacing:0.5px;margin-bottom:10px;display:block">
                    📋 订阅链接（点击复制）
                </label>
                <div class="sub-url-grid" id="subUrlGrid"></div>
            </div>

            <!-- 上传历史记录 -->
            <div class="history-section">
                <div class="history-title">
                    <span>📜 上传历史</span>
                    <button class="btn btn-sm btn-danger" onclick="clearHistory()" style="margin-left:auto">🗑️
                        清空</button>
                </div>
                <div id="historyList" class="history-list">
                    <div class="empty-state" style="padding: 20px; text-align: center; color: var(--text-muted);">
                        暂无上传记录</div>
                </div>
            </div>
        </div>

    </div>

    <script src="js/app.js?v=10"></script>

</body>

</html>